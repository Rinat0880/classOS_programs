<Window x:Class="CustomShell.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Custom Shell" 
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        Height="52" 
        WindowStartupLocation="Manual"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <!-- Стиль для кнопок панели задач -->
        <Style x:Key="TaskbarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderThickness="0"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#40FFFFFF"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#60FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для кнопок окон -->
        <Style x:Key="WindowButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="2,6"/>
            <Setter Property="Padding" Value="8,0"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="MaxWidth" Value="200"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter Margin="{TemplateBinding Padding}" 
                                            HorizontalAlignment="Left" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#30FFFFFF"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#50FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Панель задач -->
        <Border Background="#FF1F1F1F">
            <DockPanel LastChildFill="True">

                <!-- Кнопка Пуск -->
                <Button x:Name="StartButton" 
                        DockPanel.Dock="Left"
                        Style="{StaticResource TaskbarButtonStyle}"
                        Width="48"
                        Click="StartButton_Click"
                        ToolTip="Пуск">
                    <Viewbox Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M3,3 L3,21 L21,21 L21,3 Z M5,5 L19,5 L19,19 L5,19 Z M7,7 L11,7 L11,11 L7,11 Z M13,7 L17,7 L17,11 L13,11 Z M7,13 L11,13 L11,17 L7,17 Z M13,13 L17,13 L17,17 L13,17 Z"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- Системные значки справа -->
                <StackPanel DockPanel.Dock="Right" 
                           Orientation="Horizontal">

                    <!-- Язык -->
                    <Button x:Name="LanguageButton"
                            Style="{StaticResource TaskbarButtonStyle}"
                            Width="48"
                            Content="RU"
                            FontSize="12"
                            Click="LanguageButton_Click"
                            ToolTip="Язык ввода"/>

                    <!-- Часы -->
                    <Button x:Name="ClockButton"
                            Style="{StaticResource TaskbarButtonStyle}"
                            Width="80"
                            Click="ClockButton_Click">
                        <StackPanel>
                            <TextBlock x:Name="TimeText" 
                                     Text="12:00"
                                     FontSize="12"
                                     HorizontalAlignment="Center"/>
                            <TextBlock x:Name="DateText" 
                                     Text="01.01.2025"
                                     FontSize="10"
                                     HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Панель открытых окон -->
                <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                             VerticalScrollBarVisibility="Disabled">
                    <StackPanel x:Name="TaskbarItems" 
                               Orientation="Horizontal"/>
                </ScrollViewer>

            </DockPanel>
        </Border>

        <!-- Меню Пуск -->
        <Popup x:Name="StartMenuPopup" 
               PlacementTarget="{Binding ElementName=StartButton}"
               Placement="Top"
               StaysOpen="False"
               AllowsTransparency="True">
            <Border Background="#202124" 
                    BorderBrush="#FF404040" 
                    BorderThickness="1"
                    Width="320"
                    Height="480"
                    CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Заголовок -->
                    <TextBlock Text="Меню Пуск" 
                              Foreground="White"
                              FontSize="16"
                              FontWeight="SemiBold"
                              Margin="16,12"/>

                    <!-- Список приложений -->
                    <ScrollViewer Grid.Row="1" 
                                 VerticalScrollBarVisibility="Auto">
                        <StackPanel x:Name="StartMenuItems" 
                                   Margin="8"/>
                    </ScrollViewer>

                    <!-- Кнопки управления -->
                    <StackPanel Grid.Row="2" 
                               Orientation="Horizontal"
                               HorizontalAlignment="Right"
                               Margin="8">
                        <Button Content="Выход" 
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="LogoutButton_Click"/>
                        <Button Content="Завершение" 
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="ShutdownButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</Window>