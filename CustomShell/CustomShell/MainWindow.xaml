<Window x:Class="CustomShell.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:CustomShell"
        Title="Custom Shell"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        Height="48"
        WindowStartupLocation="Manual"
        PreviewKeyDown="Window_PreviewKeyDown">

	<Window.Resources>
		<!-- Единый стиль для всех кнопок панели задач -->
		<Style x:Key="UnifiedTaskbarButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                CornerRadius="4">
							<ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#292929"/>
                </Trigger>
				<Trigger Property="IsPressed" Value="True">
					<Setter Property="Background" Value="#60FFFFFF"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- Стиль для кнопок окон (иконки приложений) -->
        <Style x:Key="WindowButtonStyle" TargetType="Button" BasedOn="{StaticResource UnifiedTaskbarButtonStyle}">
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Border x:Name="BackgroundBorder"
                            Background="Transparent"
                            CornerRadius="4">
                                <ContentPresenter HorizontalAlignment="Center"
                                        VerticalAlignment="Center"/>
                            </Border>

                            <!-- Нижний индикатор активности -->
                            <Border x:Name="ActiveIndicator"
                            Height="3"
                            Width="18"
                            Background="Transparent"
                            VerticalAlignment="Bottom"
                            HorizontalAlignment="Center"
                            
                            CornerRadius="2"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="#1AFFFFFF"/>
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="#60FFFFFF"/>
                            </Trigger>

                            <Trigger Property="local:ButtonHelper.IsActiveWindow" Value="True">
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="#1AFFFFFF"/>
                                <Setter TargetName="ActiveIndicator" Property="Background" Value="#24ADF3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

	<Grid>
		<!-- Панель задач -->
		<Border Background="#1C1C1C">
			<Border BorderBrush="#404040"
                    BorderThickness="0,0.5,0,0">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<StackPanel Grid.Column="0"
                               Orientation="Horizontal"
                               HorizontalAlignment="Left"
							   Margin="12,0,0,0">

						<!-- кнопка Пуск -->
						<Button x:Name="StartButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="40"
                                Height="40"
                                Click="StartButton_Click"
                                ToolTip="Пуск">
                            <Image Source="icons/icon-windows.png" Width="32" Height="32" Stretch="Uniform"/>
                        </Button>

						<!-- панель открытых окон -->
						<ScrollViewer HorizontalScrollBarVisibility="Auto"
                                     VerticalScrollBarVisibility="Disabled" >
							<StackPanel x:Name="TaskbarItems"
                                       Orientation="Horizontal"/>
						</ScrollViewer>
					</StackPanel>

					<StackPanel Grid.Column="1"
                               Orientation="Horizontal"
                               HorizontalAlignment="Right"
							   Margin="0,0,12,0">

						<!-- стрелка вверх -->
						<Button x:Name="SystemTrayButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="32"
                                Height="40"
                                ToolTip="Показать скрытые значки">
							<Image Source="icons/up_lang.png" Width="16" Height="16" Stretch="Uniform"/>
						</Button>

						<!-- язык -->
						<Button x:Name="LanguageButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="40"
                                Height="40"
                                Click="LanguageButton_Click"
                                ToolTip="Язык ввода">
							<StackPanel HorizontalAlignment="Center">
							    <TextBlock x:Name="LangText"
		                                Text="ENG"
		                                FontSize="11"
		                                HorizontalAlignment="Center"
		                                Opacity="1.2"/>
							</StackPanel>
						</Button>

						<!-- часы и дата -->
						<Button x:Name="ClockButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="80"
                                Height="40"
                                Click="ClockButton_Click"
                                Padding="4">
							<StackPanel HorizontalAlignment="Right">
								<TextBlock x:Name="TimeText"
                                         Text="12:00"
                                         FontSize="12"
                                         HorizontalAlignment="Right"/>
								<TextBlock x:Name="DateText"
                                         Text="01.01.2025"
                                         FontSize="12"
                                         HorizontalAlignment="Center"
                                         Opacity="0.8"/>
							</StackPanel>
						</Button>
					</StackPanel>
				</Grid>
			</Border>
		</Border>

		<!-- Меню Пуск -->
		<Popup x:Name="StartMenuPopup"
               PlacementTarget="{Binding ElementName=StartButton}"
               Placement="Top"
               StaysOpen="False"
               AllowsTransparency="True">
			<Border Background="#202124"
                    BorderBrush="#FF404040"
                    BorderThickness="1"
                    Width="320"
                    Height="480"
                    CornerRadius="8">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<!-- Заголовок -->
					<TextBlock Text="Меню Пуск"
                              Foreground="White"
                              FontSize="16"
                              FontWeight="SemiBold"
                              Margin="16,12"/>

					<!-- Список приложений -->
					<ScrollViewer Grid.Row="1"
                                 VerticalScrollBarVisibility="Auto">
						<StackPanel x:Name="StartMenuItems"
                                   Margin="8"/>
					</ScrollViewer>

					<!-- Кнопки управления -->
					<StackPanel Grid.Row="2"
                               Orientation="Horizontal"
                               HorizontalAlignment="Right"
                               Margin="8">
						<Button Content="Выход"
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="LogoutButton_Click"/>
						<Button Content="Завершение"
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="ShutdownButton_Click"/>
					</StackPanel>
				</Grid>
			</Border>
		</Popup>
	</Grid>
</Window>