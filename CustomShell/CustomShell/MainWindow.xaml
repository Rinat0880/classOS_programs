<Window x:Class="CustomShell.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Custom Shell"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        Height="48"
        WindowStartupLocation="Manual"
        PreviewKeyDown="Window_PreviewKeyDown">

	<Window.Resources>
		<!-- Единый стиль для всех кнопок панели задач -->
		<Style x:Key="UnifiedTaskbarButtonStyle" TargetType="Button">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                CornerRadius="4">
							<ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Background" Value="#40FFFFFF"/>
				</Trigger>
				<Trigger Property="IsPressed" Value="True">
					<Setter Property="Background" Value="#60FFFFFF"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<!-- Стиль для кнопок окон (иконки приложений) -->
		<Style x:Key="WindowButtonStyle" TargetType="Button" BasedOn="{StaticResource UnifiedTaskbarButtonStyle}">
			<Setter Property="Width" Value="40"/>
			<Setter Property="Height" Value="40"/>
			<Setter Property="Margin" Value="1"/>
		</Style>
	</Window.Resources>

	<Grid>
		<!-- Панель задач -->
		<Border Background="#FF1F1F1F">
			<Border BorderBrush="#80FFFFFF"
                    BorderThickness="0,0.5,0,0">
				<Grid>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*"/>
						<ColumnDefinition Width="Auto"/>
					</Grid.ColumnDefinitions>

					<StackPanel Grid.Column="0"
                               Orientation="Horizontal"
                               HorizontalAlignment="Left"
							   Margin="12,0,0,0">

						<!-- кнопка Пуск -->
						<Button x:Name="StartButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="40"
                                Height="40"
                                Click="StartButton_Click"
                                ToolTip="Пуск">
							<Image Source="/CustomShell;component/icons/icon-windows.png"  Width="20" Height="20"/>
						</Button>

						<!-- панель открытых окон -->
						<ScrollViewer HorizontalScrollBarVisibility="Auto"
                                     VerticalScrollBarVisibility="Disabled" >
							<StackPanel x:Name="TaskbarItems"
                                       Orientation="Horizontal"/>
						</ScrollViewer>
					</StackPanel>

					<StackPanel Grid.Column="1"
                               Orientation="Horizontal"
                               HorizontalAlignment="Right"
							   Margin="0,0,12,0">

						<!-- стрелка вверх -->
						<Button x:Name="SystemTrayButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="32"
                                Height="40"
                                ToolTip="Показать скрытые значки">
							<Path Fill="White"
                                  Data="M7,15 L12,10 L17,15"
                                  Stretch="Uniform"
                                  Width="12"
                                  Height="12"/>
						</Button>

						<!-- язык -->
						<Button x:Name="LanguageButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="40"
                                Height="40"
                                Content="RU"
                                FontSize="12"
                                Click="LanguageButton_Click"
                                ToolTip="Язык ввода"/>

						<!-- часы и дата -->
						<Button x:Name="ClockButton"
                                Style="{StaticResource UnifiedTaskbarButtonStyle}"
                                Width="100"
                                Height="40"
                                Click="ClockButton_Click"
                                Padding="4">
							<StackPanel HorizontalAlignment="Center">
								<TextBlock x:Name="TimeText"
                                         Text="12:00"
                                         FontSize="11"
                                         HorizontalAlignment="Center"/>
								<TextBlock x:Name="DateText"
                                         Text="01.01.2025"
                                         FontSize="9"
                                         HorizontalAlignment="Center"
                                         Opacity="0.8"/>
							</StackPanel>
						</Button>
					</StackPanel>
				</Grid>
			</Border>
		</Border>

		<!-- Меню Пуск -->
		<Popup x:Name="StartMenuPopup"
               PlacementTarget="{Binding ElementName=StartButton}"
               Placement="Top"
               StaysOpen="False"
               AllowsTransparency="True">
			<Border Background="#202124"
                    BorderBrush="#FF404040"
                    BorderThickness="1"
                    Width="320"
                    Height="480"
                    CornerRadius="8">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>

					<!-- Заголовок -->
					<TextBlock Text="Меню Пуск"
                              Foreground="White"
                              FontSize="16"
                              FontWeight="SemiBold"
                              Margin="16,12"/>

					<!-- Список приложений -->
					<ScrollViewer Grid.Row="1"
                                 VerticalScrollBarVisibility="Auto">
						<StackPanel x:Name="StartMenuItems"
                                   Margin="8"/>
					</ScrollViewer>

					<!-- Кнопки управления -->
					<StackPanel Grid.Row="2"
                               Orientation="Horizontal"
                               HorizontalAlignment="Right"
                               Margin="8">
						<Button Content="Выход"
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="LogoutButton_Click"/>
						<Button Content="Завершение"
                               Width="80"
                               Height="32"
                               Margin="4"
                               Click="ShutdownButton_Click"/>
					</StackPanel>
				</Grid>
			</Border>
		</Popup>
	</Grid>
</Window>